---
title: "Creating data subsets"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating data subsets}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



When researchers request access to your data they may in many cases not be granted access to the whole dataset, but only to a subset. On the MinIO fileserver access is regulated on the project level, so you will need to create a new project using a subset of the data. Here you can see the different relevant steps you need to take to create these subsets.

## Install and load the package
You need to install and load the package first to be able to create the subsets.


```r
install.packages("MolgenisArmadillo")
```


```r
library(MolgenisArmadillo)
```

## Logging in
In order to access the files on the MinIO fileserver you need to log in using the URLs of the Armadillo server and the MinIO fileserver. A browser window will be opened where you can identify yourself with the ID provider.


```r
armadillo.login("https://armadillo.test.molgenis.org",
      "https://armadillo-minio.test.molgenis.org")
#> Error in armadillo.login("https://armadillo.test.molgenis.org", "https://armadillo-minio.test.molgenis.org"): unused argument ("https://armadillo-minio.test.molgenis.org")
```

A session will be created and the credentials are stored in the environment.

## Defining the subset
Let's assume you are in a consortium which has data that can not be shared in total to the researchers. You want to share a subset of the whole dataset with certain researchers that applied for access to your data.

We need to define at least one .csv file containing 3 columns:

| folder       | table       | variable      |
| ------------ | ----------- | ------------- |
| 2_1_core_1_0 | yearly_rep  | green_dist_   |
| 2_1_core_1_0 | yearly_rep  | green_size_   |
| 2_1_core_1_0 | yearly_rep  | green_access_ |

If you defined the tables then you can construct the `subset_definition`.


```r
subset_definition <- armadillo.subset_definition(
  vars = "data/subset/vars.csv",
subset_definition
#> Error: <text>:4:0: unexpected end of input
#> 2:   vars = "data/subset/vars.csv",
#> 3: subset_definition
#>   ^
```

After this you can create a new subset using the subset method on the Armadillo. First we are going to perform a dry-run to see which output is given by the function.


```r
not_available <- armadillo.subset(
	source_project = "gecko",
	new_project = "study1",
	subset_def = subset_definition,
	dry_run = TRUE
)
#> Error in armadillo.subset(source_project = "gecko", new_project = "study1", : object 'subset_definition' not found
not_available
#> Error in eval(expr, envir, enclos): object 'not_available' not found
```

This outputs the variables that are missing within the actual data. You can check wether you suspected this or this is an anomaly.

If you are confident that it will work you can run the subset method without dry_run.


```r
not_available <- armadillo.subset(
	source_project = "gecko",
	new_project = "study1",
	subset_def = subset_definition
)
#> Error in armadillo.subset(source_project = "gecko", new_project = "study1", : object 'subset_definition' not found
not_available
#> Error in eval(expr, envir, enclos): object 'not_available' not found
```

Now you can also take a look at the files in the user interface of the MinIO
fileserver if you open the MinIO server URL in a browser window. The test server you can find here: https://armadillo-minio.test.molgenis.org/.
